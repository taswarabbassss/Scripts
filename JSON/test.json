{
  "aggregate": "__collection__",
  "pipeline": [
    { "$match": { "_id": "6679025876135e5a6d1d3d5e" } },
    { "$unwind": "$clientDocuments" },
    {
      "$match": {
        "$and": [
          { "$and": [{ "clientDocuments.documentType": "OTHER" }] },
          {
            "$or": [
              { "clientDocuments.internalOnly": { "$ne": true } },
              {
                "$and": [
                  { "clientDocuments.internalOnly": true },
                  {
                    "clientDocuments.uploadedBy": {
                      "$in": [
                        "632851c225b5325439a2e923",
                        "6329597925b5325439a2e945",
                        "63295d1e25b5325439a2e946",
                        "6329633c25b5325439a2e96e",
                        "63b6907e4941633256dcb1f0",
                        "6329601825b5325439a2e947",
                        "6329688e25b5325439a2e9a6",
                        "6328443325b5325439a2e910",
                        "63284f2625b5325439a2e920",
                        "6329621925b5325439a2e960",
                        "6329650725b5325439a2e97c",
                        "633d32336e867906444e58f6",
                        "653b1a611a45d04defd69c7f",
                        "65853b2756fb9d23e4cbcec3",
                        "65a0ee25aaadff02fef50a6d",
                        "65cb2e1186e4c22d5d796f43",
                        "65eee0fce46c424d7c4796f5",
                        "6679159b2f93aa1394a2bacd"
                      ]
                    }
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    { "$sort": { "clientDocuments.uploadedAt": -1 } },
    {
      "$project": {
        "clientId": "$clientDocuments.clientId",
        "documentName": "$clientDocuments.documentName",
        "documentType": "$clientDocuments.documentType",
        "documentTitle": "$clientDocuments.documentTitle",
        "fileExtension": "$clientDocuments.fileExtension",
        "docVaultType": "$clientDocuments.docVaultType",
        "uploadedBy": "$clientDocuments.uploadedBy",
        "dataDomain": "$clientDocuments.dataDomain",
        "dataAccessLevel": "$clientDocuments.dataAccessLevel",
        "shareWithHouseHoldMembers": "$clientDocuments.shareWithHouseHoldMembers",
        "notes": "$clientDocuments.notes",
        "uploadedAt": "$clientDocuments.uploadedAt",
        "_id": 0,
        "internalOnly": "$clientDocuments.internalOnly",
        "uploadByAgency": "$clientDocuments.uploadByAgency",
        "documentDate": "$clientDocuments.documentDate"
      }
    },
    {
      "aggregate": "__collection__",
      "pipeline": [
        {
          "$match": {
            "$and": [
              { "status": "Active" },
              { "agency._id": "6322fb06b77f3126c8a0db92" },
              { "role.title": { "$ne": "System API" } },
              { "tenantIds": "5f572b995d15761b68b1ef0c" }
            ]
          }
        },
        {
          "$project": {
            "id": 1,
            "firstName": 1,
            "lastName": 1,
            "middleName": 1,
            "agency": 1,
            "username": 1,
            "picture": 1,
            "qhnUserName": 1,
            "title": "$role.title"
          }
        }
      ]
    }
  ]
}
